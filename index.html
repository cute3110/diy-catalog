<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DIY Circuitry Product Catalog</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    #loader {
      display: none;
      margin: 40px auto;
      width: 50px;
      height: 50px;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    #searchContainer {
      text-align: center;
      margin-bottom: 20px;
    }
    #searchInput {
      width: 60%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #productContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      min-height: 200px;
    }
    .product-card {
      border: 1px solid #ddd;
      background: #fff;
      padding: 10px;
      width: 200px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .product-card img {
      max-width: 100%;
      height: auto;
      margin-bottom: 10px;
    }
    .product-card h4 {
      margin: 10px 0 5px;
      font-size: 18px;
      color: #333;
    }
    .product-card p {
      margin: 5px 0;
      font-size: 14px;
      color: #555;
    }
    #pagination {
      text-align: center;
      margin-top: 20px;
    }
    .page-btn {
      display: inline-block;
      margin: 0 5px;
      padding: 6px 12px;
      border: 1px solid #3498db;
      color: #3498db;
      cursor: pointer;
      border-radius: 3px;
    }
    .page-btn.active {
      background: #3498db;
      color: #fff;
    }
    .page-btn:hover {
      background: #2980b9;
      color: #fff;
    }
  </style>
</head>
<body>

  <div id="loader"></div>

  <div id="searchContainer">
    <input type="search" id="searchInput" placeholder="Search products...">
  </div>

  <div id="productContainer"></div>

  <div id="pagination"></div>

  <script>
    $(document).ready(function () {
      const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToMLw2K0NsA-7oTXp-k5D0gW5VR3pG2nOGNCxqUwh3nmt48-kZQSDOGHFrKiu-pYFJG1HwH2Q7BcbR/pub?output=csv";

      let allProducts = [];
      let itemsPerPage = 5;
      let currentPage = 1;
      let prevPage = 1;
      let searchActive = false;

      function displayLoader(show) {
        $('#loader').toggle(show);
      }

      function renderPage(page) {
        let totalItems = allProducts.length;
        let totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
        if (page < 1) page = 1;
        if (page > totalPages) page = totalPages;
        currentPage = page;

        let startIndex = (page - 1) * itemsPerPage;
        let pageItems = allProducts.slice(startIndex, startIndex + itemsPerPage);

        $('#productContainer').empty();
        pageItems.forEach(product => {
          let card = $('<div class="product-card"></div>');
          if (product.photo) card.append($('<img>').attr('src', product.photo));
          card.append(`<h4>${product.name}</h4>`);
          if (product.desc) card.append(`<p>${product.desc}</p>`);
          if (product.price) card.append(`<p>₹ ${product.price}</p>`);
          $('#productContainer').append(card);
        });

        renderPagination(totalPages);
      }

      function renderPagination(totalPages) {
        $('#pagination').empty();
        if (totalPages <= 1) return;
        for (let i = 1; i <= totalPages; i++) {
          let btn = $(`<span class="page-btn">${i}</span>`);
          if (i === currentPage) btn.addClass('active');
          btn.on('click', () => renderPage(i));
          $('#pagination').append(btn);
        }
      }

      function performSearch(term) {
        let filtered = allProducts.filter(p => p.name.toLowerCase().includes(term.toLowerCase()));
        $('#productContainer').empty();
        $('#pagination').hide();
        if (filtered.length) {
          filtered.forEach(product => {
            let card = $('<div class="product-card"></div>');
            if (product.photo) card.append($('<img>').attr('src', product.photo));
            card.append(`<h4>${product.name}</h4>`);
            if (product.desc) card.append(`<p>${product.desc}</p>`);
            if (product.price) card.append(`<p>₹ ${product.price}</p>`);
            $('#productContainer').append(card);
          });
        } else {
          $('#productContainer').append("<p>No products found.</p>");
        }
      }

      $('#searchInput').on('input', function () {
        const searchTerm = $(this).val().trim();
        if (searchTerm) {
          if (!searchActive) {
            prevPage = currentPage;
            searchActive = true;
          }
          performSearch(searchTerm);
        } else {
          if (searchActive) {
            searchActive = false;
            $('#pagination').show();
            renderPage(prevPage);
          }
        }
      });

      displayLoader(true);
      Papa.parse(CSV_URL, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function (results) {
          allProducts = results.data.filter(p => p.name && p.name.trim() !== '');
          displayLoader(false);
          renderPage(currentPage);
        }
      });
    });
  </script>

</body>
</html>
